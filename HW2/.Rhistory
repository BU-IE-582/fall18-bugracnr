require(dplyr)
library(rgl)
setwd("C:/IE_582_Rep/fall18-bugracnr/HW2")
#save paths
matches_file_path = "HW2_Files/df9b1196-e3cf-4cc7-9159-f236fe738215_matches.rds"
odd_details_file_path = "HW2_Files/df9b1196-e3cf-4cc7-9159-f236fe738215_odd_details.rds"
#load data
matches=readRDS(matches_file_path)
odds=readRDS(odd_details_file_path)
matches[,match_time:=anytime(date)]
matches[,Year:=year(match_time)]
matches[,c("match_time","date","leagueId","type"):=NULL]
#Over Under & 1x2 Results
matches[,c("HomeGoals","AwayGoals"):=tstrsplit(score,':')]
matches$HomeGoals=as.numeric(matches$HomeGoals)
matches[,AwayGoals:=as.numeric(AwayGoals)]
matches[,TotalGoals:=HomeGoals+AwayGoals]
matches[,IsOver:=0]
matches[TotalGoals>2,IsOver:=1]
matches[,Is1 := HomeGoals > AwayGoals]
matches[,Is2 := HomeGoals < AwayGoals]
matches[,IsX := HomeGoals == AwayGoals]
matches[,results := Is1*1 + Is2*2 + IsX*3]
matches <- matches[complete.cases(matches)]
bmakers <- c("10Bet", "12BET", "bet365", "Betclic", "Pinnacle")
unique(odds$oddtype)
unique(odds$betType)
bettypes <- unique(odds$betType)
bettypes
bettypes <- bettypes[-2]
bettypes
odds <- odds %>% filter(bookmaker %in% bmakers, betType %in%bettypes)  %>% mutate()
odds <- as.data.table(odds)
odds
odds <- odds %>% filter(bookmaker %in% bmakers, betType %in%bettypes, totalhandicap %in% c("<NA>", "2.5"))  %>% mutate()
odds <- as.data.table(odds)
odds
odds=readRDS(odd_details_file_path)
odds <- odds %>% filter(bookmaker %in% bmakers, betType %in%bettypes, totalhandicap %in% c("NA", "2.5"))  %>% mutate()
odds <- as.data.table(odds)
odds
odds=readRDS(odd_details_file_path)
odds <- odds %>% filter(bookmaker %in% bmakers, betType %in%bettypes)  %>% mutate()
odds
odds <- as.data.table(odds)
odds
odds_ou <- odds%>% filter(betType == "ou", totalhandicap == "2.5") %>% summarize()
odds_ou
odds_ou <- odds%>% filter(betType == "ou", totalhandicap == "2.5") %>% mutate()
odds_ou
bettypes
bettypes <- unique(odds$betType)
bettypes
bettypes <- unique(odds$betType)
odds=readRDS(odd_details_file_path)
bettypes <- unique(odds$betType)
bettypes
bettypes <- bettypes[-2, -6]
bettypes <- bettypes[c(-2, -6)]
bettypes
odds_ou <- odds%>% filter(betType == "ou", totalhandicap == "2.5") %>% mutate()
odds <- odds %>% filter(bookmaker %in% bmakers, betType %in%bettypes)  %>% mutate()
unique(odds$totalhandicap)
x <- c(2,4,5)
y <- (3,7,6)
y <- c(3,7,6)
z <- cbind(x,y)
z
z <- rbind(x,y)
z
odds2 <- rbind(odds,odds_ou)
head(odds2)
odds2[968850:968863,]
odds <- rbind(odds,odds_ou)
odds <- as.data.table(odds)
unique(odds$totalhandicap)
unique(odds$oddtype)
odds <- odds[order(matchId, oddtype,bookmaker,date)]
odds_final=odds[,list(final_odd=odd[.N]),
by=list(matchId,oddtype,bookmaker)]
wide_final <- dcast(odds_final,
matchId ~ bookmaker + oddtype,
value.var="final_odd")
numna <- sapply(wide_final, function(x) sum(is.na(x)))
numna
rm(list=ls())
gc()
#save paths
matches_file_path = "HW2_Files/df9b1196-e3cf-4cc7-9159-f236fe738215_matches.rds"
odd_details_file_path = "HW2_Files/df9b1196-e3cf-4cc7-9159-f236fe738215_odd_details.rds"
#load data
matches=readRDS(matches_file_path)
odds=readRDS(odd_details_file_path)
matches[,match_time:=anytime(date)]
matches[,Year:=year(match_time)]
matches[,c("match_time","date","leagueId","type"):=NULL]
#Over Under & 1x2 Results
matches[,c("HomeGoals","AwayGoals"):=tstrsplit(score,':')]
matches$HomeGoals=as.numeric(matches$HomeGoals)
matches[,AwayGoals:=as.numeric(AwayGoals)]
matches[,TotalGoals:=HomeGoals+AwayGoals]
matches[,IsOver:=0]
matches[TotalGoals>2,IsOver:=1]
matches[,Is1 := HomeGoals > AwayGoals]
matches[,Is2 := HomeGoals < AwayGoals]
matches[,IsX := HomeGoals == AwayGoals]
matches[,results := Is1*1 + Is2*2 + IsX*3]
matches <- matches[complete.cases(matches)]
bmakers <- c("10Bet", "12BET", "bet365", "Betclic", "Pinnacle")
bettypes <- unique(odds$betType)
bettypes <- bettypes[c(-2, -6)]
odds_ou <- odds%>% filter(bookmaker %in% bmakers, betType == "ou", totalhandicap == "2.5") %>% mutate()
odds <- odds %>% filter(bookmaker %in% bmakers, betType %in%bettypes)  %>% mutate()
odds <- rbind(odds,odds_ou)
odds <- as.data.table(odds)
odds <- odds[order(matchId, oddtype,bookmaker,date)]
odds_final=odds[,list(final_odd=odd[.N]),
by=list(matchId,oddtype,bookmaker)]
wide_final <- dcast(odds_final,
matchId ~ bookmaker + oddtype,
value.var="final_odd")
numna
numna <- sapply(wide_final, function(x) sum(is.na(x)))
numna
na.omit(wide_final[2:.N,2:ncol(wide_final)])
numna <- as.data.frame(numna)
a<- rownames(numna)
a
length(a)
numna <- numna[1:nrow(numna),]
numna
length(numna)
numna <- data.table(a,numna)
numna <- numna[order(numna)]
numna
rm(list=ls())
gc()
#save paths
matches_file_path = "HW2_Files/df9b1196-e3cf-4cc7-9159-f236fe738215_matches.rds"
odd_details_file_path = "HW2_Files/df9b1196-e3cf-4cc7-9159-f236fe738215_odd_details.rds"
#load data
matches=readRDS(matches_file_path)
odds=readRDS(odd_details_file_path)
matches[,match_time:=anytime(date)]
matches[,Year:=year(match_time)]
matches[,c("match_time","date","leagueId","type"):=NULL]
#Over Under & 1x2 Results
matches[,c("HomeGoals","AwayGoals"):=tstrsplit(score,':')]
matches$HomeGoals=as.numeric(matches$HomeGoals)
matches[,AwayGoals:=as.numeric(AwayGoals)]
matches[,TotalGoals:=HomeGoals+AwayGoals]
matches[,IsOver:=0]
matches[TotalGoals>2,IsOver:=1]
matches[,Is1 := HomeGoals > AwayGoals]
matches[,Is2 := HomeGoals < AwayGoals]
matches[,IsX := HomeGoals == AwayGoals]
matches[,results := Is1*1 + Is2*2 + IsX*3]
matches <- matches[complete.cases(matches)]
bettypes <- unique(odds$betType)
bettypes <- bettypes[c(-2, -6)]
odds_ou <- odds%>% filter( betType == "ou", totalhandicap == "2.5") %>% mutate()
odds <- odds %>% filter(betType %in%bettypes)  %>% mutate()
odds <- rbind(odds,odds_ou)
odds <- as.data.table(odds)
odds <- odds[order(matchId, oddtype,bookmaker,date)]
odds_final=odds[,list(final_odd=odd[.N]),
by=list(matchId,oddtype,bookmaker)]
wide_final <- dcast(odds_final,
matchId ~ bookmaker + oddtype,
value.var="final_odd")
numna <- sapply(wide_final, function(x) sum(is.na(x)))
numna <- as.data.frame(numna)
a<- rownames(numna)
a
length(a)
numna <- numna[1:nrow(numna),]
numna
length(numna)
numna <- data.table(a,numna)
numna <- numna[order(numna)]
colnames(numna) <- c("names", "na_vals")
numna
View(numna)
View(numna)
bmakers <- c("Betsafe", "12BET", "bet365", "Betclic", "Pinnacle")
odds_ou <- odds%>% filter(bookmaker %in% bmakers, betType == "ou", totalhandicap == "2.5") %>% mutate()
odds <- odds %>% filter(bookmaker %in% bmakers, betType %in%bettypes)  %>% mutate()
#odds_ou <- odds%>% filter( betType == "ou", totalhandicap == "2.5") %>% mutate()
#odds <- odds %>% filter(betType %in%bettypes)  %>% mutate()
odds <- rbind(odds,odds_ou)
odds <- as.data.table(odds)
odds <- odds[order(matchId, oddtype,bookmaker,date)]
odds_final=odds[,list(final_odd=odd[.N]),
by=list(matchId,oddtype,bookmaker)]
wide_final <- dcast(odds_final,
matchId ~ bookmaker + oddtype,
value.var="final_odd")
numna <- sapply(wide_final, function(x) sum(is.na(x)))
numna <- as.data.frame(numna)
a<- rownames(numna)
a
length(a)
numna <- numna[1:nrow(numna),]
numna
length(numna)
numna <- data.table(a,numna)
numna <- numna[order(numna)]
numna
wide_final[,c("bet365_NO", "bet365_YES", "Betsafe_NO", "Betsafe_YES") := NULL]
na.omit(wide_final[2:.N,2:ncol(wide_final)])
rm(list=ls())
gc()
#save paths
matches_file_path = "HW2_Files/df9b1196-e3cf-4cc7-9159-f236fe738215_matches.rds"
odd_details_file_path = "HW2_Files/df9b1196-e3cf-4cc7-9159-f236fe738215_odd_details.rds"
#load data
matches=readRDS(matches_file_path)
odds=readRDS(odd_details_file_path)
matches[,match_time:=anytime(date)]
matches[,Year:=year(match_time)]
matches[,c("match_time","date","leagueId","type"):=NULL]
#Over Under & 1x2 Results
matches[,c("HomeGoals","AwayGoals"):=tstrsplit(score,':')]
matches$HomeGoals=as.numeric(matches$HomeGoals)
matches[,AwayGoals:=as.numeric(AwayGoals)]
matches[,TotalGoals:=HomeGoals+AwayGoals]
matches[,IsOver:=0]
matches[TotalGoals>2,IsOver:=1]
matches[,Is1 := HomeGoals > AwayGoals]
matches[,Is2 := HomeGoals < AwayGoals]
matches[,IsX := HomeGoals == AwayGoals]
matches[,results := Is1*1 + Is2*2 + IsX*3]
matches <- matches[complete.cases(matches)]
bmakers <- c("Betsafe", "12BET", "bet365", "Betclic", "Pinnacle")
bettypes <- unique(odds$betType)
bettypes <- bettypes[c(-2, -6)]
odds_ou <- odds%>% filter(bookmaker %in% bmakers, betType == "ou", totalhandicap == "2.5") %>% mutate()
odds <- odds %>% filter(bookmaker %in% bmakers, betType %in%bettypes)  %>% mutate()
odds <- rbind(odds,odds_ou)
odds <- as.data.table(odds)
odds <- odds[order(matchId, oddtype,bookmaker,date)]
odds_final=odds[,list(final_odd=odd[.N]),
by=list(matchId,oddtype,bookmaker)]
wide_final <- dcast(odds_final,
matchId ~ bookmaker + oddtype,
value.var="final_odd")
numna <- sapply(wide_final, function(x) sum(is.na(x)))
numna <- as.data.frame(numna)
a<- rownames(numna)
numna <- numna[1:nrow(numna),]
numna <- data.table(a,numna)
numna <- numna[order(numna)]
wide_final[,c("bet365_NO", "bet365_YES", "Betsafe_NO", "Betsafe_YES") := NULL]
wide_final <- dcast(odds_final,
matchId ~ bookmaker + oddtype,
value.var="final_odd")
wide_final[2:.N,2:ncol(wide_final)])
na.omit(wide_final[2:.N,2:ncol(wide_final)])
wide_final[,c("bet365_NO", "bet365_YES", "Betsafe_NO", "Betsafe_YES") := NULL]
na.omit(wide_final[2:.N,2:ncol(wide_final)])
wide_final <- dcast(odds_final,
matchId ~ bookmaker + oddtype,
value.var="final_odd")
pca <- princomp(na.omit(wide_final[2:.N,2:ncol(wide_final)]))
summary(pca)
plot(pca)
summary(pca)
pca
summary(pca)
plot(pca$scores, col = matches$IsOver + 2)
plot(pca$scores, col = matches$results + 1)
plot(pca)
a <- dist(na.omit(wide_final[,2:ncol(wide_final)]), method = "euclidean")
fit <- cmdscale(a)
plot(fit[,1],fit[,2],main='Location',xlab='', ylab='',col=1)
a <- dist(na.omit(wide_final[,2:ncol(wide_final)]), method = "manhattan")
fit <- cmdscale(a)
plot(fit[,1],fit[,2],main='Location',xlab='', ylab='',col=1)
pca$loadings
pca$loadings[,1:2]
results <- pca$loadings[,1:2]
results <- as.data.table(results)
results
results[order("Comp. 1", "Comp. 2")]
results[order(c("Comp. 1", "Comp. 2")]
results[order("Comp. 1", "Comp. 2")]
results
results <- pca$loadings[,1:2]
results
summary(pca)
res <- as.data.frame(summary(pca))
res
res <- as.list(summary(pca))
res
res <- as.data.frame(res)
res$loadings
str(pca)
summary(pca)
plot(pca)
plot(pca)
summary(pca)
pca$loadings
results <- pca$loadings[,1:2]
results
biplot(pca)
rnames <- rownames(results)
rnames
results <- pca$loadings[1,1:2]
results
results <- pca$loadings[,1:2]
results <- [1:nrow(results),]
results <- results[1:nrow(results),]
results <- data.table(rnames,results)
results
results[order("Comp.1, Comp.2")]
results <- results[order("Comp.1, Comp.2")]
results
results <- pca$loadings[,1:2]
results
plot(results     )
manhattan_distances <- dist(na.omit(wide_final[,2:ncol(wide_final)]), method = "manhattan")
euclidean_distances <- dist(na.omit(wide_final[,2:ncol(wide_final)]), method = "euclidean")
fit <- cmdscale(manhattan_distances)
na.omit(wide_final[2:.N,2:ncol(wide_final)])
wide_final[complete.cases(wide_final)]
pca <- princomp(na.omit(wide_final[2:.N,]))
wide_final[2:.N,2:ncol(wide_final)]
wide_final[1,1]
wide_final[1,]
wide_final[,1]
pca <- princomp(na.omit(wide_final[,2:ncol(wide_final)]))
na.omit(wide_final[,2:ncol(wide_final)])
wide_final
wide_final <- wide_final[complete.cases(wide_final)]
pca <- princomp(wide_final[,2:ncol(wide_final)])
biplot(pca)
summary(pca)
wide_final
match_colors <- merge(wide_final[,"matchId"], matches[,c("matchId", "IsOver, Results")], by = "matchId")
matches
match_colors <- merge(wide_final[,"matchId"], matches[,c("matchId", "IsOver, results")], by = "matchId")
match_colors <- merge(wide_final[,"matchId"], matches[,c("matchId", "IsOver", "results")], by = "matchId")
match_colors
wide_final
matches
match_colors
matches <- matches[complete.cases(matches)]
matches
match_colors <- merge(wide_final[,"matchId"], matches[,c("matchId", "IsOver", "results")], by = "matchId")
match_colors
wide_final
identical(wide_final$matchId, match_colors$matchId)
match_colors$control <- match_colors$matchId == wide_final$matchId
match_colors
View(match_colors)
matches <- unique(matches)
matches <- matches[complete.cases(matches)]
match_colors <- merge(wide_final[,"matchId"], matches[,c("matchId", "IsOver", "results")], by = "matchId")
identical(wide_final$matchId, match_colors$matchId)
match_colors$control <- match_colors$matchId == wide_final$matchId
match_colors
matches <- unique(matches)
matches <- matches[complete.cases(matches)]
match_colors <- merge(wide_final[,"matchId"], matches[,c("matchId", "IsOver", "results")], by = "matchId")
identical(wide_final$matchId, match_colors$matchId)
match_colors
wide_final
odds <- unique(odds)
odds_final=odds[,list(final_odd=odd[.N]),
by=list(matchId,oddtype,bookmaker)]
wide_final <- dcast(odds_final,
matchId ~ bookmaker + oddtype,
value.var="final_odd")
wide_final[,c("bet365_NO", "bet365_YES", "Betsafe_NO", "Betsafe_YES") := NULL]
wide_final <- wide_final[complete.cases(wide_final)]
match_colors <- merge(wide_final[,"matchId"], matches[,c("matchId", "IsOver", "results")], by = "matchId")
identical(wide_final$matchId, match_colors$matchId)
wide_final
wide_final <- wide_final[complete.cases(wide_final)]
wide_final
match_colors <- merge(wide_final[,"matchId"], matches[,c("matchId", "IsOver", "results")], by = "matchId")
match_colors
wide_final <- unique(wide_final)
wide_final
rm(list=ls())
gc()
#save paths
matches_file_path = "HW2_Files/df9b1196-e3cf-4cc7-9159-f236fe738215_matches.rds"
odd_details_file_path = "HW2_Files/df9b1196-e3cf-4cc7-9159-f236fe738215_odd_details.rds"
#load data
matches=readRDS(matches_file_path)
odds=readRDS(odd_details_file_path)
matches[,match_time:=anytime(date)]
matches[,Year:=year(match_time)]
matches[,c("match_time","date","leagueId","type"):=NULL]
#Over Under & 1x2 Results
matches[,c("HomeGoals","AwayGoals"):=tstrsplit(score,':')]
matches$HomeGoals=as.numeric(matches$HomeGoals)
matches[,AwayGoals:=as.numeric(AwayGoals)]
matches[,TotalGoals:=HomeGoals+AwayGoals]
matches[,IsOver:=0]
matches[TotalGoals>2,IsOver:=1]
matches[,Is1 := HomeGoals > AwayGoals]
matches[,Is2 := HomeGoals < AwayGoals]
matches[,IsX := HomeGoals == AwayGoals]
matches[,results := Is1*1 + Is2*2 + IsX*3]
matches <- unique(matches)
matches <- matches[complete.cases(matches)]
bmakers <- c("Betsafe", "12BET", "bet365", "Betclic", "Pinnacle")
bettypes <- unique(odds$betType)
bettypes <- bettypes[c(-2, -6)]
odds_ou <- odds%>% filter(bookmaker %in% bmakers, betType == "ou", totalhandicap == "2.5") %>% mutate()
odds <- odds %>% filter(bookmaker %in% bmakers, betType %in%bettypes)  %>% mutate()
odds <- rbind(odds,odds_ou)
odds <- as.data.table(odds)
odds <- odds[order(matchId, oddtype,bookmaker,date)]
odds <- unique(odds)
odds_final=odds[,list(final_odd=odd[.N]),
by=list(matchId,oddtype,bookmaker)]
wide_final <- dcast(odds_final,
matchId ~ bookmaker + oddtype,
value.var="final_odd")
wide_final
numna <- sapply(wide_final, function(x) sum(is.na(x)))
numna <- as.data.frame(numna)
a<- rownames(numna)
numna <- numna[1:nrow(numna),]
numna <- data.table(a,numna)
numna <- numna[order(numna)]
numna
wide_final[,c("bet365_NO", "bet365_YES", "Betsafe_NO", "Betsafe_YES") := NULL]
wide_final <- wide_final[complete.cases(wide_final)]
wide_final <- unique(wide_final)
wide_final
match_colors <- merge(wide_final[,"matchId"], matches[,c("matchId", "IsOver", "results")], by = "matchId")
match_colors
wide_final <- wide_final[matchId == matches$matchId]
wide_final <- wide_final[matchId %in% matches$matchId]
wide_final
match_colors
match_colors <- merge(wide_final[,"matchId"], matches[,c("matchId", "IsOver", "results")], by = "matchId")
identical(wide_final$matchId, match_colors$matchId)
pca <- princomp(wide_final[,2:ncol(wide_final)])
plot(pca$scores, col = match_colors$IsOver + 2)
plot(pca$scores, col = match_colors$results + 1)
plot(pca$scores, col = match_colors$IsOver + 2)
manhattan_distances <- dist(na.omit(wide_final[,2:ncol(wide_final)]), method = "manhattan")
euclidean_distances <- dist(na.omit(wide_final[,2:ncol(wide_final)]), method = "euclidean")
manhattan_distances
fit <- cmdscale(manhattan_distances)
plot(fit[,1],fit[,2],main='Location',xlab='', ylab='',col= match_colors$IsOver)
plot(fit[,1],fit[,2],main='Location',xlab='', ylab='',col= match_colors$IsOver + 2)
fit <- cmdscale(euclidean_distances)
plot(fit[,1],fit[,2],main='Location',xlab='', ylab='',col= match_colors$IsOver + 2)
rm(list=ls())
gc()
#save paths
matches_file_path = "HW2_Files/df9b1196-e3cf-4cc7-9159-f236fe738215_matches.rds"
odd_details_file_path = "HW2_Files/df9b1196-e3cf-4cc7-9159-f236fe738215_odd_details.rds"
#load data
matches=readRDS(matches_file_path)
odds=readRDS(odd_details_file_path)
matches[,match_time:=anytime(date)]
matches[,Year:=year(match_time)]
matches[,c("match_time","date","leagueId","type"):=NULL]
#Over Under & 1x2 Results
matches[,c("HomeGoals","AwayGoals"):=tstrsplit(score,':')]
matches$HomeGoals=as.numeric(matches$HomeGoals)
matches[,AwayGoals:=as.numeric(AwayGoals)]
matches[,TotalGoals:=HomeGoals+AwayGoals]
matches[,IsOver:=0]
matches[TotalGoals>2,IsOver:=1]
matches[,Is1 := HomeGoals > AwayGoals]
matches[,Is2 := HomeGoals < AwayGoals]
matches[,IsX := HomeGoals == AwayGoals]
matches[,results := Is1*1 + Is2*2 + IsX*3]
matches <- unique(matches)
matches <- matches[complete.cases(matches)]
bmakers <- c("Betsafe", "12BET", "bet365", "Betclic", "Pinnacle")
bettypes <- unique(odds$betType)
bettypes <- bettypes[c(-2, -6)]
odds_ou <- odds%>% filter(bookmaker %in% bmakers, betType == "ou", totalhandicap == "2.5") %>% mutate()
odds <- odds %>% filter(bookmaker %in% bmakers, betType %in%bettypes)  %>% mutate()
odds <- rbind(odds,odds_ou)
odds <- as.data.table(odds)
odds <- odds[order(matchId, oddtype,bookmaker,date)]
odds <- unique(odds)
odds_final=odds[,list(final_odd=odd[.N]),
by=list(matchId,oddtype,bookmaker)]
wide_final <- dcast(odds_final,
matchId ~ bookmaker + oddtype,
value.var="final_odd")
wide_final <- wide_final[complete.cases(wide_final)]
wide_final <- unique(wide_final)
wide_final <- wide_final[matchId %in% matches$matchId]
match_colors <- merge(wide_final[,"matchId"], matches[,c("matchId", "IsOver", "results")], by = "matchId")
pca <- princomp(wide_final[,2:ncol(wide_final)])
biplot(pca)
summary(pca)
plot(pca)
results <- pca$loadings[,1:2]
results
plot(pca$scores, col = match_colors$IsOver + 2)
plot(pca$scores, col = match_colors$results + 1)
manhattan_distances <- dist(na.omit(wide_final[,2:ncol(wide_final)]), method = "manhattan")
euclidean_distances <- dist(na.omit(wide_final[,2:ncol(wide_final)]), method = "euclidean")
fit_manhattan <- cmdscale(manhattan_distances)
plot(fit_manhattan[,1],fit_manhattan[,2],main='Location',xlab='', ylab='',col= match_colors$IsOver + 2)
fit_euclidean <- cmdscale(euclidean_distances)
plot(fit_euclidean[,1],fit_euclidean[,2],main='Location',xlab='', ylab='',col= match_colors$IsOver + 2)
plot(fit_manhattan[,1],fit_manhattan[,2],main='Location',xlab='', ylab='',col= match_colors$IsOver + 2)
plot(fit_euclidean[,1],fit_euclidean[,2],main='Location',xlab='', ylab='',col= match_colors$IsOver + 2)
